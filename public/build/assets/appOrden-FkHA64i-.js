import{r as p,R as e}from"./index-C2KC86Ta.js";import{u as R,c as T}from"./useAxiosAuth-pfDa2iXj.js";import{a as D}from"./index-B9ygI19o.js";const j=()=>{const[a,c]=p.useState({tiposDocumento:[],paises:[],municipios:[],epsList:[]});return p.useEffect(()=>{(()=>{try{c({tiposDocumento:JSON.parse(localStorage.getItem("documentos_paciente_data"))||[],paises:JSON.parse(localStorage.getItem("paises_data"))||[],municipios:JSON.parse(localStorage.getItem("municipios_data"))||[],epsList:JSON.parse(localStorage.getItem("eps_data"))||[]})}catch(d){console.error("Error al cargar las referencias:",d)}})()},[]),a},z=()=>{const[a,c]=p.useState({modalidades:[],finalidades:[],viasIngreso:[],tiposAfiliacion:[],servicios:[],causaAtencion:[]});return p.useEffect(()=>{(async()=>{const d=async(n,x)=>{let _=JSON.parse(localStorage.getItem(n))||[];if(_.length===0)try{_=(await D.get(x)).data||[],localStorage.setItem(n,JSON.stringify(_))}catch(S){console.error(`Error al cargar ${n}`,S)}return _},i=await d("modalidad_atencion_data","/api/modalidades-atencion"),m=await d("finalidad_consulta_data","/api/finalidades"),s=await d("via_ingreso_data","/api/via-ingreso"),l=await d("tipos_afiliacion_data","/api/tipos-afiliacion"),r=await d("servicios_habilitados_data","/api/servicios-habilitados");c({modalidades:i,finalidades:m,viasIngreso:s,tiposAfiliacion:l,servicios:r,causaAtencion:[]})})()},[]),a},C=({name:a,label:c,value:t,options:d=[],onChange:i,required:m=!1,disabled:s=!1,error:l,codigo:r=!1})=>e.createElement("div",null,e.createElement("label",{htmlFor:a,className:"block font-medium text-sm text-text"},c," ",m&&e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{id:a,name:a,className:`text-sm h-9 w-full p-1 border-borders focus:border-primary focus:ring-primary rounded-md uppercase ${l?"border-red-500":""}`,value:t??"",onChange:i,disabled:s},e.createElement("option",{value:""},"Seleccione una opci√≥n"),Array.isArray(d)&&d.map(n=>e.createElement("option",{className:"capitalize",key:n.key??n.codigo,value:n.codigo},r?`${n.codigo} - ${n.nombre}`:n.nombre))),l&&e.createElement("div",{className:"text-red-500"},l)),L=()=>e.createElement("div",{className:"fixed inset-0 flex justify-center items-center h-full z-50 bg-white bg-opacity-50"},e.createElement("div",{className:"loader animate-spin rounded-full border-8 border-t-primary h-16 w-16"})),V=()=>e.createElement("div",{className:"fixed inset-0 flex justify-center items-center h-full z-50 bg-white bg-opacity-90"},e.createElement("div",{className:"text-center"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})),e.createElement("p",{className:"mt-2 text-lg font-medium text-gray-800"},"Completado"))),q=(a,c,t)=>{const[d,i]=p.useState({numero_documento:null,fecha_nacimiento:null});p.useEffect(()=>{if(!a||!c)return;const l=new RegExp(a.regex_validacion).test(c);i(r=>({...r,numero_documento:l?null:"Formato inv√°lido para este tipo de documento"}))},[c,a]),p.useEffect(()=>{if(!a||!t)return;const s=m(t),{edad_minima:l,edad_maxima:r}=a,n=(!l||s>=l)&&(!r||s<=r);i(x=>({...x,fecha_nacimiento:n?null:`Edad no v√°lida para ${a.nombre} (${s} a√±os)`}))},[t,a]);const m=s=>{const l=new Date,r=new Date(s);let n=l.getFullYear()-r.getFullYear();const x=l.getMonth()-r.getMonth();return(x<0||x===0&&l.getDate()<r.getDate())&&n--,n};return d};D.defaults.withCredentials=!0;const J=({persona:a,setPersona:c,perfil:t})=>{const[d,i]=p.useState(null),[m,s]=p.useState(!1),[l,r]=p.useState(null),[n,x]=p.useState({id:null,perfil:"",tipo_documento:"CC",numero_documento:"",nombres:"",apellidos:"",fecha_nacimiento:"",sexo:"",pais_nacimiento:"170",municipio:"11001",direccion:"",telefono:"",zona:"02",pais_residencia:"170",correo:"",eps:"",tipo_afiliacion:""}),{tiposDocumento:_,paises:S,municipios:N,epsList:y}=j(),{tiposAfiliacion:f}=z();p.useEffect(()=>{(async()=>{try{await D.get("/sanctum/csrf-cookie"),console.log("CSRF cookie obtained")}catch(b){console.error("Could not get CSRF cookie",b)}})()},[]);const w=_.find(g=>g.cod_rips===n.tipo_documento),E=q(w,n.numero_documento,n.fecha_nacimiento);p.useEffect(()=>{x(g=>({...g,perfil:t||""}))},[t]);const v=async g=>{if(g.trim()){s(!0);try{const b=await D.get(`/api/personas/buscar/${g}`);if(b.status!==200)return null;const u=b.data;return u?(console.log("‚úÖ Persona encontrada:",u),i(u),u):(i(null),null)}catch(b){return console.log("‚ùå Error al buscar persona:",b),i(null),null}finally{s(!1)}}},A=async g=>{const b=g.target.value.trim();if(!b)return;const u=await v(b);if(u&&u.data){const o=u.data;x(F=>({...F,id:o.id||null,perfil:"",tipo_documento:o.tipo_documento||"",numero_documento:o.numero_documento||"",nombres:o.nombre||"",apellidos:o.apellido||"",fecha_nacimiento:o.fecha_nacimiento||"",sexo:o.sexo||"",pais_nacimiento:o.pais_origen||"",municipio:o.municipio||"",direccion:o.direccion||"",telefono:o.telefono||"",zona:o.zona||"",pais_residencia:o.pais_residencia||"",correo:o.correo||"",eps:o.eps||"",tipo_afiliacion:o.tipo_afiliacion||""}))}},h=g=>{const{name:b,value:u}=g.target;x(o=>({...o,[b]:u}))},P=async g=>{g.preventDefault(),s(!0),r(null);try{const b=d!==null,u=b?`/api/personas/${d.data.id}`:"/api/personas";console.log("üìã ENVIANDO FORMULARIO (STATEFUL):",{operacion:b?"Actualizaci√≥n":"Nuevo Registro",url:u,datos:n});const F=(await D({method:b?"PUT":"POST",url:u,data:n})).data;console.log("‚úÖ Operaci√≥n exitosa:",F);const I=F.data;i(null),c&&c(I),alert(b?"Persona actualizada exitosamente":"Persona creada exitosamente"),x({id:null,perfil:"",tipo_documento:"CC",numero_documento:"",nombres:"",apellidos:"",fecha_nacimiento:"",sexo:"",pais_nacimiento:"170",municipio:"11001",direccion:"",telefono:"",zona:"02",pais_residencia:"170",correo:"",eps:"",tipo_afiliacion:""}),i(null)}catch(b){console.error("‚ùå Error completo:",b),console.error("Respuesta del servidor:",b.response?.data);let u="Error al procesar la solicitud";b.response?.status===422?u=`Errores de validaci√≥n:
${Object.values(b.response.data.errors||{}).flat().join(`
`)}`:b.response?.status===401||b.response?.status===419?u="Tu sesi√≥n ha expirado. Por favor, inicia sesi√≥n nuevamente.":b.response?.data?.message&&(u=b.response.data.message),r(u),alert(u)}finally{s(!1)}};return e.createElement(e.Fragment,null,m&&e.createElement(L,null),e.createElement("form",{onSubmit:P,className:"max-w-screen-lg mx-auto"},e.createElement("div",{className:"flex gap-4"},e.createElement("h2",{className:"font-bold mb-4 text-xl text-titles"},"Nuevo registro de ",t," ")),a&&e.createElement("div",{className:"mb-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded"},e.createElement("strong",null,t," seleccionado:")," ",a.data.primer_nombre," ",a.data.primer_apellido," - Documento: ",a.data.numero_documento),e.createElement("div",{className:"inputs_container md:grid md:grid-cols-2 gap-8 w-full min-w-80 p-4"},e.createElement("div",{className:"flex flex-col gap-4 mb-4 md:m-0"},e.createElement(C,{label:"Tipo de Documento",name:"tipo_documento",value:n.tipo_documento,onChange:h,codigo:!0,options:_.map(g=>({key:g.id,codigo:g.cod_rips,nombre:g.nombre}))}),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"N√∫mero de Documento"),e.createElement("div",{className:"relative"},e.createElement("input",{type:"text",name:"numero_documento",value:n.numero_documento,onChange:h,onBlur:A,className:E.numero_documento?"h-9 w-full p-2 border-borders focus:border-red-500 focus:ring-red-500 rounded-md":"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),m&&e.createElement("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2"},e.createElement("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"})),E.numero_documento&&e.createElement("div",{className:"text-sm text-red-500 mt-1"},E.numero_documento))),t==="Paciente"&&e.createElement(C,{label:"Pais de Nacimiento",name:"pais_nacimiento",value:n.pais_nacimiento,onChange:h,codigo:!1,options:S.map(g=>({codigo:g.codigo_iso,nombre:g.nombre}))}),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Nombres"),e.createElement("input",{type:"text",name:"nombres",value:n.nombres,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Apellidos"),e.createElement("input",{type:"text",name:"apellidos",value:n.apellidos,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),t!=="Pagador"&&e.createElement("div",null,e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("label",{className:"block font-medium text-sm text-text"},"Fecha de Nacimiento"),e.createElement("input",{type:"date",name:"fecha_nacimiento",value:n.fecha_nacimiento,onChange:h,className:E.fecha_nacimiento?"h-9 w-full p-2 border-borders rounded-md focus:border-red-500 focus:ring-red-500":"h-9 w-full p-2 border-borders rounded-md focus:border-primary focus:ring-primary"})),E.fecha_nacimiento&&e.createElement("div",{className:"text-sm text-red-500 mt-1"},E.fecha_nacimiento)),t==="Paciente"&&e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("span",{className:"font-semibold"},"Sexo"),e.createElement("label",{htmlFor:"sexo_femenino",className:"inline-flex items-center"},"F"),e.createElement("input",{type:"radio",id:"sexo_femenino",name:"sexo",value:"F",checked:n.sexo==="F",onChange:h,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"sexo_masculino",className:"inline-flex items-center"},"M"),e.createElement("input",{type:"radio",id:"sexo_masculino",name:"sexo",value:"M",checked:n.sexo==="M",onChange:h,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"sexo_otro",className:"inline-flex items-center"},"Intersexual"),e.createElement("input",{type:"radio",id:"sexo_otro",name:"sexo",value:"I",checked:n.sexo==="I",onChange:h,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"})),t==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"EPS"),e.createElement("input",{list:"eps_list",name:"eps",value:n.eps,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),e.createElement("datalist",{id:"eps_list"},y.map(g=>e.createElement("option",{key:g.id,value:g.nombre})))),t==="Paciente"&&e.createElement(C,{label:"Tipo de Afiliaci√≥n",name:"tipo_afiliacion",value:n.tipo_afiliacion,onChange:h,codigo:!0,options:f.data})),e.createElement("div",{className:"flex flex-col gap-4 mb-4 md:m-0"},e.createElement("div",null,e.createElement("h3",{className:"font-medium text-normal text-titles my-4"},"Informaci√≥n de contacto")),t==="Paciente"&&e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("span",{className:"font-semibold"},"Zona de Residencia"),e.createElement("label",{htmlFor:"zona_urbana",className:"inline-flex items-center"},"Urbana"),e.createElement("input",{type:"radio",id:"zona_urbana",name:"zona",value:"02",checked:n.zona==="02",onChange:h,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"zona_rural",className:"inline-flex items-center"},"Rural"),e.createElement("input",{type:"radio",id:"zona_rural",name:"zona",value:"01",checked:n.zona==="01",onChange:h,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"})),t==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Direcci√≥n"),e.createElement("input",{type:"text",name:"direccion",value:n.direccion,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Tel√©fono"),e.createElement("input",{type:"text",name:"telefono",value:n.telefono,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),t==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Email"),e.createElement("input",{type:"email",name:"correo",value:n.correo,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),t==="Paciente"&&e.createElement(C,{label:"Pais de Residencia",name:"pais_residencia",value:n.pais_residencia,onChange:h,codigo:!1,options:S.map(g=>({codigo:g.codigo_iso,nombre:g.nombre}))}),t==="Paciente"&&e.createElement(C,{label:"Municipio",name:"municipio",value:n.municipio,onChange:h,codigo:!1,options:N.map(g=>({codigo:g.codigo,nombre:`${g.municipio} - ${g.departamento}`}))}),t==="Acompaniante"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Parentesco"),e.createElement("input",{list:"parentesco_list",name:"Parentesco",value:n.parentesco,onChange:h,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),e.createElement("datalist",{id:"parentesco_list"},e.createElement("option",{value:"Madre"}),e.createElement("option",{value:"Padre"}),e.createElement("option",{value:"Hermano(a)"}),e.createElement("option",{value:"Hijo(a)"}),e.createElement("option",{value:"Esposo(a)"}),e.createElement("option",{value:"Amigo(a)"}))))),e.createElement("div",{className:"flex justify-end space-x-3"},e.createElement("button",{type:"submit",disabled:m,className:"inline-flex items-center justify-center rounded-md border border-transparent bg-primary py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-titles focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50"},m?e.createElement(e.Fragment,null,e.createElement("div",{className:"animate-spin mr-2 h-4 w-4 border-b-2 border-white rounded-full"}),d?"Actualizando...":"Guardando..."):d?"Actualizar":"Guardar"))))},B=()=>{const[a,c]=p.useState([]),[t,d]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{const m=await D.get("/api/examenes");c(m.data||[])}catch(m){console.error("Error al cargar ex√°menes",m)}finally{d(!1)}})()},[]),{examenes:a,loading:t}},Y=({examenes:a,onRemove:c,onCantidadChange:t,onChangeValores:d})=>{console.log("TablaExamenes - examenes recibidos:",a);const[i,m]=p.useState(0),[s,l]=p.useState(0),[r,n]=p.useState(!1),[x,_]=p.useState(!1);if(!Array.isArray(a))return console.error("TablaExamenes: examenes no es un array"),null;const S=E=>{const v=parseFloat(E.target.value);m(isNaN(v)?0:v)},N=E=>{const v=parseFloat(E.target.value);l(isNaN(v)?0:v)},y=E=>typeof E=="number"?E:typeof E=="string"&&parseFloat(E)||0,f=a.reduce((A,h)=>{const P=h.cantidad||1,g=y(h.valor);return A+P*g},0)-(x?s:0),w=r?f-i:f;return console.log("valor State abono:",i),console.log("valor State descuento:",s),console.log("valor total antes de abono y descuento:",f),p.useEffect(()=>{console.log("useEffect - Valores actualizados:",{total:f,abono:i,descuento:s,saldo:w}),d("total",f),d("abono",r?i:0)},[f,i,s,w,r,x]),e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"w-full mt-4"},e.createElement("thead",{className:"bg-gray-50"},e.createElement("tr",null,e.createElement("th",{className:"px-4 py-2 text-left"},"C√≥digo"),e.createElement("th",{className:"px-4 py-2 text-left"},"Nombre"),e.createElement("th",{className:"px-4 py-2 text-left"},"Cantidad"),e.createElement("th",{className:"px-4 py-2 text-right"},"Valor U."),e.createElement("th",{className:"px-4 py-2 text-right"},"Subtotal"),e.createElement("th",{className:"px-4 py-2"}))),e.createElement("tbody",null,a.map((E,v)=>E?e.createElement("tr",{key:v,className:"border-b hover:bg-gray-50"},e.createElement("td",{className:"px-4 py-2"},E.cup||"N/A"),e.createElement("td",{className:"px-4 py-2"},E.nombre||"Sin nombre"),e.createElement("td",{className:"p-2"},e.createElement("input",{type:"number",min:"1",value:E.cantidad||1,onChange:A=>t(v,parseInt(A.target.value)||1),className:"w-20 px-2 py-1 border rounded focus:outline-none focus:ring-1 focus:ring-primary"})),e.createElement("td",{className:"px-4 py-2 text-right"},"$",y(E.valor).toFixed(2)),e.createElement("td",{className:"px-4 py-2 text-right"},"$",((E.cantidad||1)*y(E.valor)).toFixed(2)),e.createElement("td",{className:"px-4 py-2 text-center"},e.createElement("button",{onClick:()=>c(v),className:"text-red-500 hover:text-red-700"},"‚ùå"))):(console.warn(`Examen en √≠ndice ${v} es null o undefined`),null))),e.createElement("tfoot",null,r&&e.createElement("tr",{className:`border-t-2 border-gray-200 font-semibold ${i>f?"text-red-600":""}`},e.createElement("td",{colSpan:"4",className:"px-4 py-3 text-right"},"Abono:"),e.createElement("td",{className:"px-4 py-3 text-right"},e.createElement("input",{type:"number",onChange:S})),e.createElement("td",null)),r&&e.createElement("tr",{className:"border-t-2 border-gray-200 font-semibold"},e.createElement("td",{colSpan:"4",className:"px-4 py-3 text-right"},"Saldo:"),e.createElement("td",{className:"px-4 py-3 text-right"},"$",w.toFixed(2)),e.createElement("td",null)),x&&e.createElement("tr",{className:"border-t-2 border-gray-200 font-semibold"},e.createElement("td",{colSpan:"4",className:"px-4 py-3 text-right"},"Descuento:"),e.createElement("td",{className:"px-4 py-3 text-right"},e.createElement("input",{type:"number",onChange:N})),e.createElement("td",null)),e.createElement("tr",{className:`border-t-2 border-gray-200 font-semibold ${x&&s>f?"text-red-600":""}`},e.createElement("td",{colSpan:"4",className:"px-4 py-3 text-right"},"Total:"),e.createElement("td",{className:"px-4 py-3 text-right"},"$",f.toFixed(2)),e.createElement("td",null)))),e.createElement("div",null,e.createElement("button",{onClick:()=>_(!x)},"Descuento"),e.createElement("button",{onClick:()=>n(!r)},"Abono")))},G=({disponibles:a,onAgregar:c,examenesActuales:t,onClose:d,sexoPaciente:i})=>{const m=new Set(t.map(r=>r.id)),[s,l]=p.useState(a);return e.useEffect(()=>{l(i==="M"?a.filter(r=>r.sexo_aplicable!=="F"):i==="F"?a.filter(r=>r.sexo_aplicable!=="M"):a)},[i,a]),console.log('ModalExamenes - Ex√°menes "disponibles":',a),e.createElement("div",{className:"fixed inset-0 flex items-center justify-center z-50"},e.createElement("div",{className:"modal border border-secondary shadow-lg p-4 bg-white rounded-lg w-full max-w-2xl"},e.createElement("h3",{className:"text-xl font-semibold mb-4"},"Seleccionar Ex√°menes"),e.createElement("div",{className:"max-h-[60vh] overflow-y-auto"},e.createElement("ul",{className:"space-y-2"},s.map(r=>e.createElement("li",{key:r.id,className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded"},e.createElement("div",null,e.createElement("span",{className:"mr-2"},r.cup),e.createElement("span",{className:"mr-2"},r.nombre),e.createElement("span",null,"$",r.valor)),e.createElement("button",{disabled:m.has(r.id),onClick:()=>c(r),className:`px-3 py-1 rounded ${m.has(r.id)?"bg-gray-200 text-gray-500":"bg-primary text-white"}`},m.has(r.id)?"Agregado":"Agregar"))))),e.createElement("div",{className:"mt-4 flex justify-end"},e.createElement("button",{onClick:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800"},"Cerrar"))))},H=({formExamenes:a,onUpdate:c,persona:t,onChangeValores:d})=>{const{examenes:i}=B(),m=i?.data||[],[s,l]=p.useState(!1),[r,n]=p.useState(t?.sexo||"A"),x=N=>{a.some(f=>f.id===N.id)||c([...a,{...N,cantidad:1}])},_=N=>{const y=[...a];y.splice(N,1),c(y)},S=(N,y)=>{if(y<1)return;const f=[...a];f[N]={...f[N],cantidad:y},c(f)};return console.log("Ex√°menes disponibles, desde localStorage var=disponibles:",m),console.log("Ex√°menes en el formulario, prop formExamenes:",a),e.createElement("section",null,e.createElement("h2",null,"Ex√°menes"),e.createElement("button",{className:"bg-secondary",onClick:()=>l(!0)},"Agregar examen"),a.length===0&&e.createElement("p",null,"No hay ex√°menes seleccionados."),a.length>0&&e.createElement(Y,{examenes:a,onRemove:_,onCantidadChange:S,onChangeValores:d}),s&&e.createElement(G,{disponibles:m,examenesActuales:a,onAgregar:x,onClose:()=>l(!1),sexoPaciente:r}))},U=({persona:a})=>{if(!a)return console.warn("DatosPersona: No se proporcion√≥ el objeto persona"),null;const c=t=>{try{if(!t)return"No especificada";const d=new Date,i=new Date(t);if(isNaN(i.getTime()))return console.warn("Fecha de nacimiento inv√°lida:",t),"Fecha inv√°lida";let m=d.getFullYear()-i.getFullYear();const s=d.getMonth()-i.getMonth();return(s<0||s===0&&d.getDate()<i.getDate())&&m--,m<0||m>150?(console.warn("Edad calculada fuera de rango:",m),"Edad fuera de rango"):`${m} a√±os`}catch(d){return console.error("Error al calcular la edad:",d),"Error al calcular edad"}};return console.log("Renderizando DatosPersona con:",a),a?e.createElement("section",{className:"print_paciente grid grid-cols-2 py-2 border-t-[0.2px] border-b-[0.2px] border-borders w-full"},e.createElement("div",{className:"col-span-2 flex gap-2"},e.createElement("span",{className:"font-normal"},"Paciente: "),e.createElement("h3",{className:"text-titles font-normal"},`${a.primer_nombre||""} ${a.primer_apellido||""} ${a.segundo_nombre||""} ${a.segundo_apellido||""}`)),e.createElement("div",{className:"w-full grid grid-cols-[auto_1fr] gap-x-4 gap-y-0"},e.createElement("span",{className:"font-normal"},"Identificaci√≥n: "),e.createElement("h3",{className:"text-titles font-light"},`${a.tipo_documento?.cod_rips||""} ${a.numero_documento||""}`),e.createElement("span",{className:"font-normal"},"Sexo: "),e.createElement("h3",{className:"text-titles font-light"},(()=>{const t=a.sexo;return t?{M:"Masculino",F:"Femenino",I:"Intersexual"}[t]||"Otro":"No especificado"})()),e.createElement("span",{className:"font-normal"},"Edad: "),e.createElement("h3",{className:"text-titles font-light"},a.fecha_nacimiento?c(a.fecha_nacimiento):"No especificada")),e.createElement("div",{className:"grid grid-cols-[auto_1fr] gap-x-4 gap-y-0"},e.createElement("span",{className:"font-normal"},"Fecha de atenci√≥n: "),e.createElement("h3",{className:"text-titles font-light"},new Date().toLocaleDateString("es-CO")),e.createElement("span",{className:"font-normal"},"Fecha de Nacimiento: "),e.createElement("h3",{className:"text-titles font-light"},a.fecha_nacimiento?new Date(a.fecha_nacimiento).toLocaleDateString("es-CO"):"No especificada"))):(console.warn("DatosPersona: persona es null o undefined"),null)},W=()=>{const[a,c]=p.useState({cie10:[],cups:[]});return p.useEffect(()=>{(async()=>{const d=async(s,l)=>{let r=JSON.parse(localStorage.getItem(s))||[];if(r.length===0)try{r=(await D.get(l)).data||[],localStorage.setItem(s,JSON.stringify(r))}catch(n){console.error(`Error al cargar ${s}`,n)}return r},i=await d("default_cies_data","/api/cie10"),m=await d("cups_data","/api/cups");c({cie10:i,cups:m})})()},[]),a},Z=({formOrden:a,onUpdate:c,error:t})=>{const{modalidades:d,finalidades:i,viasIngreso:m,servicios:s}=z(),{cie10:l}=W();return e.createElement("section",null,e.createElement("h2",null,"Datos de la Orden"),e.createElement("div",{className:"grid grid-cols-2 gap-4"},e.createElement(C,{label:"Modalidad de Atenci√≥n",name:"modalidad",value:a.modalidad||"",codigo:!0,options:d,onChange:c,error:t?.modalidad}),e.createElement(C,{label:"Servicio Habilitado",name:"cod_servicio",value:a.cod_servicio||"",codigo:!0,options:s,onChange:c,error:t?.cod_servicio}),e.createElement(C,{label:"CIE Principal",name:"cie_principal",value:a.cie_principal||"",codigo:!0,options:l,onChange:c,error:t?.cie_principal}),e.createElement(C,{label:"CIE Relacionado",name:"cie_relacionado",value:a.cie_relacionado||"",codigo:!0,options:l,onChange:c,error:t?.cie_relacionado}),e.createElement(C,{label:"Finalidad de Consulta",name:"finalidad",value:a.finalidad||"",codigo:!0,options:i,onChange:c,error:t?.finalidad}),e.createElement(C,{label:"V√≠a de Ingreso",name:"via_ingreso",value:a.via_ingreso||"",codigo:!0,options:m,onChange:c,error:t?.via_ingreso})))},K={cod_servicio:706,via_ingreso:"01",cie_principal:null,cie_relacionado:null,finalidad:"16",modalidad:"01"},$={numero_orden:{required:!0,validate:a=>/^[1-9]\d{0,4}$/.test(a),message:"Debe ser un n√∫mero positivo de 1 a 5 d√≠gitos (sin ceros al inicio)"},paciente_id:{required:!0,validate:a=>a!==null&&a>0,message:"Debe seleccionar un paciente v√°lido"},examenes:{required:!0,validate:a=>a.length!==0,message:"Debe seleccionar al menos un examen"},cod_servicio:{required:!0,message:"Debe seleccionar un servicio v√°lido"},via_ingreso:{required:!0,message:"Debe seleccionar una v√≠a de ingreso v√°lida"},cie_principal:{required:!0,message:"El diagn√≥stico principal es obligatorio"},finalidad:{required:!0,message:"Debe seleccionar una finalidad v√°lida"},modalidad:{required:!0,message:"Debe seleccionar una modalidad v√°lida"},abono:{required:!1,validate:a=>a<=total,message:"El abono no puede exceder el total"},total:{required:!0,validate:a=>a>=0,message:"El total no puede ser negativo"}};function Q(){const[a,c]=p.useState({}),t=(m,s)=>{const l=$[m];return l&&l.required?l.validate?l.validate(s):s!==null&&s!==""&&s!==void 0:!0};return{errors:a,validateForm:m=>{const s={};let l=!0;return Object.keys($).forEach(r=>{const n=m[r],x=$[r];t(r,n)||(s[r]=x.message,l=!1)}),c(s),l},validateField:t,clearError:m=>{c(s=>({...s,[m]:""}))}}}const X=(a,{dataDefoult:c=K}={})=>{const{axiosInstance:t,csrfLoaded:d}=R(),[i,m]=p.useState(null);p.useEffect(()=>{(async()=>{try{const o=await t.get("/api/ordenes/max-numero");o.status===200?(m(o.data.next_numero),console.log("‚úÖ Siguiente n√∫mero de orden obtenido:",o.data.next_numero)):console.error("‚ùå Error al obtener el siguiente n√∫mero de orden, estado:",o.status)}catch(o){console.error("‚ùå Error al obtener el siguiente n√∫mero de orden:",o)}})()},[t]);const s={numero_orden:i||"",paciente_id:null,examenes:[],cod_servicio:null,via_ingreso:"",cie_principal:null,cie_relacionado:null,finalidad:"",modalidad:"",abono:0,total:0,fecha_orden:new Date().toISOString().split("T")[0]+" "+new Date().toTimeString().slice(0,5)},[l,r]=p.useState(a.paciente||null),[n,x]=p.useState(!1),[_,S]=p.useState(!1),[N,y]=p.useState(null),[f,w]=p.useState(s),{validateForm:E,errors:v,clearError:A}=Q();console.log("datos recibidos de paciente:",a),p.useEffect(()=>{l&&w(u=>{const o={...u,paciente_id:l.id||null};return console.log("üìù Estado del formulario actualizado:",o),o})},[l]),p.useEffect(()=>{i!==null&&(w(u=>({...u,numero_orden:i})),console.log("‚úÖ numero_orden actualizado en el formulario:",i))},[i]),p.useEffect(()=>{if(c&&Object.keys(c).length>0){const{cod_servicio:u,via_ingreso:o,cie_principal:F,cie_relacionado:I,finalidad:O,modalidad:M}=c;w(k=>({...k,cod_servicio:u||k.cod_servicio,via_ingreso:o||k.via_ingreso,cie_principal:F||k.cie_principal,cie_relacionado:I||k.cie_relacionado,finalidad:O||k.finalidad,modalidad:M||k.modalidad}))}},[]),console.log("üìù Estado del formulario despu√©s de aplicar datos por defecto:",f);const h=u=>{if(console.log("üîÑ Actualizando persona:",u),!u){console.error("Error: nuevaPersona es null o undefined");return}const o=u?.data||u;if(!o.id){console.error("Error: La persona no tiene ID");return}r(o)},P=u=>{const{name:o,value:F}=u.target;w(I=>({...I,[o]:F})),A(o)},g=(u,o)=>{w(F=>({...F,[u]:o})),A(u)},b=async u=>{if(u.preventDefault(),!d){y("‚è≥ Autenticaci√≥n en progreso...");return}if(console.log("Validando orden:",f),!E(f)){console.log("Errores de validaci√≥n:",v),alert("Por favor complete todos los campos obligatorios");return}x(!0),y(null);try{if(!f.paciente_id){y("Por favor, seleccione un paciente.");return}if(f.examenes.length===0){y("Por favor, seleccione al menos un examen.");return}const o=await t.post("/api/ordenes",f);S(!0),o?.data?.data?.id&&(window.location.href=`/ordenes-medicas/${o.data.data.id}/ver`)}catch(o){y(o.response?.data?.message||"Error al crear la orden")}finally{x(!1)}};return N?e.createElement("div",{className:"text-red-600"},"Error: ",N):e.createElement(e.Fragment,null,_&&e.createElement(V,null),e.createElement("div",{className:"crear-orden-wrapper relative"},e.createElement("div",{className:"header max-w-5xl mx-2 lg:mx-auto sm:p-2 md:p-4 lg:p-8"},e.createElement("h1",{className:"text-2xl font-bold text-titles mb-4"},"Crear Nueva Orden"),e.createElement("label",{htmlFor:"numero_orden",className:"text-xl pr-4"},"Numero de Orden: "),e.createElement("input",{type:"number",onChange:P,name:"numero_orden",value:f.numero_orden,className:`h-9 w-32 p-2 border-borders focus:border-primary focus:ring-primary rounded-md ${v.numero_orden?"border-red-500":""}`}),v.numero_orden&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},v.numero_orden)),e.createElement("section",{className:"paciente_container max-w-5xl mx-2 lg:mx-auto sm:p-2 md:p-4 lg:p-8 bg-background rounded-xl border border-secondary shadow-md mb-4"},l?e.createElement(e.Fragment,null,e.createElement(U,{persona:l}),e.createElement("div",{className:"mt-4 flex justify-end"},e.createElement("button",{onClick:()=>r(null),className:"px-4 py-2 text-sm text-gray-600 hover:text-primary"},"Cambiar paciente"))):e.createElement(J,{persona:l,setPersona:h,perfil:"Paciente"})),l&&e.createElement("section",{className:"examenes_container max-w-5xl mx-2 lg:mx-auto sm:p-2 md:p-4 lg:p-8 bg-background rounded-xl border border-secondary shadow-md mb-4"},e.createElement(H,{formExamenes:f.examenes,onUpdate:u=>w(o=>({...o,examenes:u})),persona:l,onChangeValores:g})),f.examenes.length>0&&e.createElement("section",{className:"resumen_container max-w-5xl mx-2 lg:mx-auto sm:p-2 md:p-4 lg:p-8 bg-background rounded-xl border border-secondary shadow-md mb-4"},e.createElement(Z,{formOrden:f,onUpdate:P,error:v})),e.createElement("div",{className:"flex justify-end px-4 py-2 max-w-5xl mx-2 lg:mx-auto sm:p-2 md:p-4 lg:p-8"},e.createElement("button",{type:"button",onClick:b,disabled:n,className:"inline-flex items-center justify-center rounded-md border border-transparent bg-primary py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-titles focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50"},n?e.createElement(e.Fragment,null,e.createElement("div",{className:"animate-spin mr-2 h-4 w-4 border-b-2 border-white rounded-full"}),n?"Actualizando...":"Guardando..."):"Nueva Orden"))))};if(document.getElementById("react-crear-orden")){const a=document.getElementById("react-crear-orden"),c=JSON.parse(a.getAttribute("data-persona"))??null;T.createRoot(a).render(e.createElement(X,{paciente:c}))}
