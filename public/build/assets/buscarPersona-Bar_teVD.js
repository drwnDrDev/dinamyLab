document.getElementById("buscarPersona");const E=document.getElementById("tipo_documento"),r=document.getElementById("numero_documento"),m=document.getElementById("pais");document.getElementById("perfil").addEventListener("change",function(n){n.target.value===1?(document.getElementById("fecha_nacimiento").setAttribute("required","required"),document.getElementById("sexo").setAttribute("required","required"),document.getElementById("municipio").setAttribute("required","required")):(document.getElementById("fecha_nacimiento").removeAttribute("required"),document.getElementById("sexo").removeAttribute("required"),document.getElementById("municipio").removeAttribute("required"))});const u={id:null},g=document.getElementById("tipoGuardado"),v=()=>{const n=u.id?"actualizar":"crear";g.textContent=n,g.url=u.id?`/personas/${u.id}/editar`:"/personas/crear"};document.getElementById("crearPersona").addEventListener("submit",function(n){n.preventDefault();const e=n.target,a=new FormData(e);axios.post("/api/personas",a,{headers:{"X-CSRF-TOKEN":"{{ csrf_token() }}","Content-Type":"multipart/form-data",Accept:"application/json"}}).then(o=>{u.id=o.data.data.id}).catch(o=>{if(o.response?.status===422){console.warn("Errores de validación:",o.response.data.errors);const d=o.response.data.errors,t=Object.values(d).flat(),s=document.createElement("ul");t.forEach(h=>{const p=document.createElement("li");p.textContent=h,s.appendChild(p)});const l=document.createElement("div");l.classList.add("text-sm","text-red-600","space-y-1"),l.appendChild(s),e.appendChild(l),setTimeout(()=>{l.remove()},5e3)}else console.error("Error desconocido:",o)})});r.addEventListener("blur",function(n){n.preventDefault();const e="/api/personas/buscar/",a=document.getElementById("numero_documento").value;if(a.length>3){const o=e+a;axios.get(o).then(d=>{if(d.data&&d.data.data){const t=d.data.data;u.id=t.id,document.getElementById("nombres").value=t.nombre,document.getElementById("apellidos").value=t.apellido,document.getElementById("numero_documento").value=t.numero_documento,document.getElementById("fecha_nacimiento").value=t.fecha_nacimiento,document.getElementById("direccion").value=t.direccion,document.getElementById("telefono").value=t.telefono,document.getElementById("correo").value=t.correo,document.getElementsByName("sexo").forEach(s=>{s.value===t.sexo&&(s.checked=!0)}),document.getElementById("tipo_documento").value=t.tipo_documento,document.getElementById("municipio").value=t.municipio,document.getElementById("municipioBusqueda").value=t.ciudad||"",document.getElementById("pais").value=t.pais||"COL",document.getElementById("eps").value=t.eps||""}else v()}).catch(d=>{console.error("Error fetching persona:",d)}).then(()=>{v()})}});E.addEventListener("change",function(n){const e=E.value;e==="CC"||e==="RC"||e==="TI"||e==="CE"?(r.setAttribute("maxlength","10"),r.setAttribute("placeholder","Número de documento"),m.style.display="none"):(e==="PA"||e==="PP"||e==="PE"||e==="PS"||e==="PT"||e==="AS"||e==="MS")&&(r.setAttribute("maxlength","16"),r.setAttribute("placeholder","Identificación temporal"),r.setAttribute("type","text"),m.style.display="flex",m.addEventListener("focus",function(a){axios.get("/api/paises").then(o=>{o.data?o.data.data.paises.forEach(d=>{const t=document.createElement("option");t.value=d.codigo_iso,t.textContent=d.nombre,t.className=["text-gray-900","dark:text-gray-100"],m.appendChild(t)}):alert("No se encontró el país")}).catch(o=>{console.error("Error fetching countries:",o)})}))});const c=document.getElementById("municipioBusqueda"),i=document.getElementById("opciones"),f=document.getElementById("municipio");let I=Array.from(f.options).map(n=>({value:n.value,text:n.text}));function y(n){const e=I.filter(a=>a.text.toLowerCase().includes(n.toLowerCase()));B(e)}function B(n){i.innerHTML="",n.length>0?(n.forEach(e=>{const a=document.createElement("div");a.classList.add("p-2","cursor-pointer","hover:bg-gray-200","dark:hover:bg-gray-700","capitalize"),a.textContent=e.text,a.addEventListener("click",()=>{c.value=e.text,f.value=e.value,i.classList.remove("block")}),i.appendChild(a)}),i.classList.remove("hidden"),i.classList.add("flex")):i.classList.remove("flex")}c.addEventListener("input",()=>{const n=c.value;y(n)});c.addEventListener("blur",()=>{setTimeout(()=>{i.classList.remove("flex"),i.classList.add("hidden")},200)});c.addEventListener("focus",()=>{y(c.value)});
