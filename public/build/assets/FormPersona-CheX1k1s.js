import{r as p,R as e}from"./index-C2KC86Ta.js";import{a as y}from"./index-B9ygI19o.js";const I=()=>{const[n,f]=p.useState({tiposDocumento:[],paises:[],municipios:[],epsList:[]});return p.useEffect(()=>{(()=>{try{f({tiposDocumento:JSON.parse(localStorage.getItem("documentos_paciente_data"))||[],paises:JSON.parse(localStorage.getItem("paises_data"))||[],municipios:JSON.parse(localStorage.getItem("municipios_data"))||[],epsList:JSON.parse(localStorage.getItem("eps_data"))||[]})}catch(c){console.error("Error al cargar las referencias:",c)}})()},[]),n},R=()=>{const[n,f]=p.useState({modalidades:[],finalidades:[],viasIngreso:[],tiposAfiliacion:[],servicios:[],causaAtencion:[]});return p.useEffect(()=>{(async()=>{const c=async(a,g)=>{let x=JSON.parse(localStorage.getItem(a))||[];if(x.length===0)try{x=(await y.get(g)).data||[],localStorage.setItem(a,JSON.stringify(x))}catch(_){console.error(`Error al cargar ${a}`,_)}return x},b=await c("modalidad_atencion_data","/api/modalidades-atencion"),E=await c("finalidad_consulta_data","/api/finalidades"),m=await c("via_ingreso_data","/api/via-ingreso"),d=await c("tipos_afiliacion_data","/api/tipos-afiliacion"),u=await c("servicios_habilitados_data","/api/servicios-habilitados");f({modalidades:b,finalidades:E,viasIngreso:m,tiposAfiliacion:d,servicios:u,causaAtencion:[]})})()},[]),n},v=({name:n,label:f,value:r,options:c=[],onChange:b,required:E=!1,disabled:m=!1,error:d,codigo:u=!1})=>e.createElement("div",null,e.createElement("label",{htmlFor:n,className:"block font-medium text-sm text-text"},f," ",E&&e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{id:n,name:n,className:`text-sm h-9 w-full p-1 border-borders focus:border-primary focus:ring-primary rounded-md uppercase ${d?"border-red-500":""}`,value:r??"",onChange:b,disabled:m},e.createElement("option",{value:""},"Seleccione una opciÃ³n"),Array.isArray(c)&&c.map(a=>e.createElement("option",{className:"capitalize",key:a.key??a.codigo,value:a.codigo},u?`${a.codigo} - ${a.nombre}`:a.nombre))),d&&e.createElement("div",{className:"text-red-500"},d)),O=()=>e.createElement("div",{className:"fixed inset-0 flex justify-center items-center h-full z-50 bg-white bg-opacity-50"},e.createElement("div",{className:"loader animate-spin rounded-full border-8 border-t-primary h-16 w-16"})),T=(n,f,r)=>{const[c,b]=p.useState({numero_documento:null,fecha_nacimiento:null});p.useEffect(()=>{if(!n||!f)return;const d=new RegExp(n.regex_validacion).test(f);b(u=>({...u,numero_documento:d?null:"Formato invÃ¡lido para este tipo de documento"}))},[f,n]),p.useEffect(()=>{if(!n||!r)return;const m=E(r),{edad_minima:d,edad_maxima:u}=n,a=(!d||m>=d)&&(!u||m<=u);b(g=>({...g,fecha_nacimiento:a?null:`Edad no vÃ¡lida para ${n.nombre} (${m} aÃ±os)`}))},[r,n]);const E=m=>{const d=new Date,u=new Date(m);let a=d.getFullYear()-u.getFullYear();const g=d.getMonth()-u.getMonth();return(g<0||g===0&&d.getDate()<u.getDate())&&a--,a};return c};y.defaults.withCredentials=!0;const M=({persona:n,setPersona:f,perfil:r})=>{const[c,b]=p.useState(null),[E,m]=p.useState(!1),[d,u]=p.useState(null),[a,g]=p.useState({id:null,perfil:"",tipo_documento:"CC",numero_documento:"",nombres:"",apellidos:"",fecha_nacimiento:"",sexo:"",pais_nacimiento:"170",municipio:"11001",direccion:"",telefono:"",zona:"02",pais_residencia:"170",correo:"",eps:"",tipo_afiliacion:""}),{tiposDocumento:x,paises:_,municipios:w,epsList:S}=I(),{tiposAfiliacion:k}=R();p.useEffect(()=>{(async()=>{try{await y.get("/sanctum/csrf-cookie"),console.log("CSRF cookie obtained")}catch(o){console.error("Could not get CSRF cookie",o)}})()},[]);const C=x.find(t=>t.cod_rips===a.tipo_documento),h=T(C,a.numero_documento,a.fecha_nacimiento);p.useEffect(()=>{g(t=>({...t,perfil:r||""}))},[r]);const P=async t=>{if(t.trim()){m(!0);try{const o=await y.get(`/api/personas/buscar/${t}`);if(o.status!==200)return null;const l=o.data;return l?(console.log("âœ… Persona encontrada:",l),b(l),l):(b(null),null)}catch(o){return console.log("âŒ Error al buscar persona:",o),b(null),null}finally{m(!1)}}},F=async t=>{const o=t.target.value.trim();if(!o)return;const l=await P(o);if(l&&l.data){const s=l.data;g(N=>({...N,id:s.id||null,perfil:"",tipo_documento:s.tipo_documento||"",numero_documento:s.numero_documento||"",nombres:s.nombre||"",apellidos:s.apellido||"",fecha_nacimiento:s.fecha_nacimiento||"",sexo:s.sexo||"",pais_nacimiento:s.pais_origen||"",municipio:s.municipio||"",direccion:s.direccion||"",telefono:s.telefono||"",zona:s.zona||"",pais_residencia:s.pais_residencia||"",correo:s.correo||"",eps:s.eps||"",tipo_afiliacion:s.tipo_afiliacion||""}))}},i=t=>{const{name:o,value:l}=t.target;g(s=>({...s,[o]:l}))},z=async t=>{t.preventDefault(),m(!0),u(null);try{const o=c!==null,l=o?`/api/personas/${c.data.id}`:"/api/personas";console.log("ðŸ“‹ ENVIANDO FORMULARIO (STATEFUL):",{operacion:o?"ActualizaciÃ³n":"Nuevo Registro",url:l,datos:a});const N=(await y({method:o?"PUT":"POST",url:l,data:a})).data;console.log("âœ… OperaciÃ³n exitosa:",N);const A=N.data;b(null),f&&f(A),alert(o?"Persona actualizada exitosamente":"Persona creada exitosamente"),g({id:null,perfil:"",tipo_documento:"CC",numero_documento:"",nombres:"",apellidos:"",fecha_nacimiento:"",sexo:"",pais_nacimiento:"170",municipio:"11001",direccion:"",telefono:"",zona:"02",pais_residencia:"170",correo:"",eps:"",tipo_afiliacion:""}),b(null)}catch(o){console.error("âŒ Error completo:",o),console.error("Respuesta del servidor:",o.response?.data);let l="Error al procesar la solicitud";o.response?.status===422?l=`Errores de validaciÃ³n:
${Object.values(o.response.data.errors||{}).flat().join(`
`)}`:o.response?.status===401||o.response?.status===419?l="Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.":o.response?.data?.message&&(l=o.response.data.message),u(l),alert(l)}finally{m(!1)}};return e.createElement(e.Fragment,null,E&&e.createElement(O,null),e.createElement("form",{onSubmit:z,className:"max-w-screen-lg mx-auto"},e.createElement("div",{className:"flex gap-4"},e.createElement("h2",{className:"font-bold mb-4 text-xl text-titles"},"Nuevo registro de ",r," ")),n&&e.createElement("div",{className:"mb-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded"},e.createElement("strong",null,r," seleccionado:")," ",n.data.primer_nombre," ",n.data.primer_apellido," - Documento: ",n.data.numero_documento),e.createElement("div",{className:"inputs_container md:grid md:grid-cols-2 gap-8 w-full min-w-80 p-4"},e.createElement("div",{className:"flex flex-col gap-4 mb-4 md:m-0"},e.createElement(v,{label:"Tipo de Documento",name:"tipo_documento",value:a.tipo_documento,onChange:i,codigo:!0,options:x.map(t=>({key:t.id,codigo:t.cod_rips,nombre:t.nombre}))}),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"NÃºmero de Documento"),e.createElement("div",{className:"relative"},e.createElement("input",{type:"text",name:"numero_documento",value:a.numero_documento,onChange:i,onBlur:F,className:h.numero_documento?"h-9 w-full p-2 border-borders focus:border-red-500 focus:ring-red-500 rounded-md":"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),E&&e.createElement("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2"},e.createElement("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"})),h.numero_documento&&e.createElement("div",{className:"text-sm text-red-500 mt-1"},h.numero_documento))),r==="Paciente"&&e.createElement(v,{label:"Pais de Nacimiento",name:"pais_nacimiento",value:a.pais_nacimiento,onChange:i,codigo:!1,options:_.map(t=>({codigo:t.codigo_iso,nombre:t.nombre}))}),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Nombres"),e.createElement("input",{type:"text",name:"nombres",value:a.nombres,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Apellidos"),e.createElement("input",{type:"text",name:"apellidos",value:a.apellidos,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),r!=="Pagador"&&e.createElement("div",null,e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("label",{className:"block font-medium text-sm text-text"},"Fecha de Nacimiento"),e.createElement("input",{type:"date",name:"fecha_nacimiento",value:a.fecha_nacimiento,onChange:i,className:h.fecha_nacimiento?"h-9 w-full p-2 border-borders rounded-md focus:border-red-500 focus:ring-red-500":"h-9 w-full p-2 border-borders rounded-md focus:border-primary focus:ring-primary"})),h.fecha_nacimiento&&e.createElement("div",{className:"text-sm text-red-500 mt-1"},h.fecha_nacimiento)),r==="Paciente"&&e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("span",{className:"font-semibold"},"Sexo"),e.createElement("label",{htmlFor:"sexo_femenino",className:"inline-flex items-center"},"F"),e.createElement("input",{type:"radio",id:"sexo_femenino",name:"sexo",value:"F",checked:a.sexo==="F",onChange:i,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"sexo_masculino",className:"inline-flex items-center"},"M"),e.createElement("input",{type:"radio",id:"sexo_masculino",name:"sexo",value:"M",checked:a.sexo==="M",onChange:i,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"sexo_otro",className:"inline-flex items-center"},"Intersexual"),e.createElement("input",{type:"radio",id:"sexo_otro",name:"sexo",value:"I",checked:a.sexo==="I",onChange:i,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"})),r==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"EPS"),e.createElement("input",{list:"eps_list",name:"eps",value:a.eps,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),e.createElement("datalist",{id:"eps_list"},S.map(t=>e.createElement("option",{key:t.id,value:t.nombre})))),r==="Paciente"&&e.createElement(v,{label:"Tipo de AfiliaciÃ³n",name:"tipo_afiliacion",value:a.tipo_afiliacion,onChange:i,codigo:!0,options:k.data})),e.createElement("div",{className:"flex flex-col gap-4 mb-4 md:m-0"},e.createElement("div",null,e.createElement("h3",{className:"font-medium text-normal text-titles my-4"},"InformaciÃ³n de contacto")),r==="Paciente"&&e.createElement("div",{className:"w-full pb-2 flex gap-2 items-center"},e.createElement("span",{className:"font-semibold"},"Zona de Residencia"),e.createElement("label",{htmlFor:"zona_urbana",className:"inline-flex items-center"},"Urbana"),e.createElement("input",{type:"radio",id:"zona_urbana",name:"zona",value:"02",checked:a.zona==="02",onChange:i,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"}),e.createElement("label",{htmlFor:"zona_rural",className:"inline-flex items-center"},"Rural"),e.createElement("input",{type:"radio",id:"zona_rural",name:"zona",value:"01",checked:a.zona==="01",onChange:i,className:"h-4 w-4 border-borders focus:border-primary focus:ring-primary checked:bg-primary"})),r==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"DirecciÃ³n"),e.createElement("input",{type:"text",name:"direccion",value:a.direccion,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"TelÃ©fono"),e.createElement("input",{type:"text",name:"telefono",value:a.telefono,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),r==="Paciente"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Email"),e.createElement("input",{type:"email",name:"correo",value:a.correo,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"})),r==="Paciente"&&e.createElement(v,{label:"Pais de Residencia",name:"pais_residencia",value:a.pais_residencia,onChange:i,codigo:!1,options:_.map(t=>({codigo:t.codigo_iso,nombre:t.nombre}))}),r==="Paciente"&&e.createElement(v,{label:"Municipio",name:"municipio",value:a.municipio,onChange:i,codigo:!1,options:w.map(t=>({codigo:t.codigo,nombre:`${t.municipio} - ${t.departamento}`}))}),r==="Acompaniante"&&e.createElement("div",null,e.createElement("label",{className:"block font-medium text-sm text-text"},"Parentesco"),e.createElement("input",{list:"parentesco_list",name:"Parentesco",value:a.parentesco,onChange:i,className:"h-9 w-full p-2 border-borders focus:border-primary focus:ring-primary rounded-md"}),e.createElement("datalist",{id:"parentesco_list"},e.createElement("option",{value:"Madre"}),e.createElement("option",{value:"Padre"}),e.createElement("option",{value:"Hermano(a)"}),e.createElement("option",{value:"Hijo(a)"}),e.createElement("option",{value:"Esposo(a)"}),e.createElement("option",{value:"Amigo(a)"}))))),e.createElement("div",{className:"flex justify-end space-x-3"},e.createElement("button",{type:"submit",disabled:E,className:"inline-flex items-center justify-center rounded-md border border-transparent bg-primary py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-titles focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50"},E?e.createElement(e.Fragment,null,e.createElement("div",{className:"animate-spin mr-2 h-4 w-4 border-b-2 border-white rounded-full"}),c?"Actualizando...":"Guardando..."):c?"Actualizar":"Guardar"))))};export{M as F,v as S,R as u};
