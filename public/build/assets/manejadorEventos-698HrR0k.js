const c=Object.freeze({PACIENTE:"Paciente",ACOMPANIANTE:"Acompañante",NUEVO_USUARIO:"nuevoUsuario",ACTUALIZAR_USUARIO:"actualizarUsuario",PACIENTE_ID:"paciente_id",ACOMPANIANTE_ID:"acompaniante_id",TIPO_DOCUMENTO:"tipo_documento",DOCUMENTOS_PACIENTE:"documentos_paciente",PAISES:"paises",MUNICIPIOS:"municipios",EPS:"eps",CREAR_PACIENTE:"crearPaciente",CREAR_ACOMPANIANTE:"crearacompaniante",BUSQUEDA_EXAMEN:"busquedaExamen"}),i={todosLosExamenes:[],examenesVisibles:[],defaultCies:JSON.parse(localStorage.getItem("default_cies_data"))||[],tiposDocumento:JSON.parse(localStorage.getItem(c.DOCUMENTOS_PACIENTE))||[],municipios:JSON.parse(localStorage.getItem(c.MUNICIPIOS))||[],paises:JSON.parse(localStorage.getItem(c.PAISES))||[],eps:JSON.parse(localStorage.getItem(c.EPS))||[],csrfToken:document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",filteredMunicipios:[]},r={crearPaciente:document.getElementById(c.CREAR_PACIENTE),crearAcompaniante:document.getElementById(c.CREAR_ACOMPANIANTE),paciente:document.getElementById(c.PACIENTE_ID),acompaniante:document.getElementById(c.ACOMPANIANTE_ID),handleShowAcompaniante:document.getElementById("mostrarAcompaniante"),busquedaExamenInput:document.getElementById(c.BUSQUEDA_EXAMEN),examenesContainer:document.getElementById("examenesContainer"),totalExamenesSpan:document.getElementById("totalExamenes"),listaEps:document.getElementById("lista_eps"),residenteColombiano:document.getElementById("residenteColombiano"),guardarOtro:document.getElementById("guardarOtro")},x=(e,t)=>{e.tipoGuardado.value=c.ACTUALIZAR_USUARIO,e.tipoGuardado.textContent="Actualizar Usuario",e.numero_documento.value=t.numero_documento,y(e.tipo_documento),e.tipo_documento.value=t.tipo_documento,e.nombres.value=t.nombre,e.apellidos.value=t.apellido,e.fecha_nacimiento.value=t.fecha_nacimiento,e.telefono.value=t.telefono,e.correo.value=t.correo,C(e.eps),e.eps.value=t.eps,e.direccion.value=t.direccion,b(e.municipio),e.municipio.value=t.municipio,e.municipioBusqueda.value=i.municipios.find(a=>a.codigo===t.municipio)?.municipio||"",e.municipio.classList.remove("hidden"),e.municipioBusqueda.classList.add("hidden"),e.tipo_afiliacion.value=t.tipo_afiliacion,v(e.pais),e.pais.value=t.pais_origen||"170",e.querySelectorAll('input[name="sexo"]').forEach(a=>{a.checked=a.value===t.sexo}),e.querySelectorAll('input[name="zona"]').forEach(a=>{a.checked=a.value===t.zona}),e.perfil.value===c.PACIENTE?r.paciente.value=t.id:r.acompaniante.value=t.id},u=(e,t)=>{let a=e.querySelector(".error-container");a||(a=document.createElement("div"),a.className="error-container text-sm text-red-600 space-y-1 mt-2",e.appendChild(a));const n=Object.values(t).flat().map(o=>`<li>${o}</li>`).join("");a.innerHTML=`<ul>${n}</ul>`,setTimeout(()=>a.remove(),5e3)},p=(e,t)=>{const a=document.createElement("option");return a.value=t,a.textContent=e,a.className="text-gray-700 dark:text-gray-300 capitalize",a.dataset.valor=t,a.dataset.label=e,a},v=e=>{e.innerHTML="",i.paises.forEach(t=>{e.appendChild(p(t.nombre,t.codigo_iso))})},C=e=>{e.innerHTML="",i.eps.forEach(t=>{e.appendChild(p(t.nombre,t.nombre))})},b=e=>{e.innerHTML="",i.municipios.forEach(t=>{e.appendChild(p(`${t.municipio} - ${t.departamento}`,t.codigo))})},y=e=>{e.innerHTML="",i.tiposDocumento.forEach(t=>{e.appendChild(p(t.nombre,t.cod_rips))})},E=(e,t)=>{const a=e.querySelector(".municipio-busqueda"),n=e.querySelector('input[name="municipioBusqueda"]'),o=e.querySelector('select[name="municipio"]');a.innerHTML="",a.classList.remove("hidden"),t.forEach(s=>{const d=document.createElement("div");d.className="p-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 capitalize",d.textContent=s.municipio+" - "+s.departamento,d.addEventListener("mousedown",()=>{n.value=d.textContent,o.value=s.codigo,a.classList.add("hidden"),o.classList.remove("hidden"),n.classList.add("hidden"),e.querySelector(".municipio-busqueda").classList.add("hidden"),e.querySelector(".municipio-busqueda").innerHTML=""}),a.appendChild(d)})},h=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=axios.create({headers:{"X-CSRF-TOKEN":h,Accept:"application/json"}}),T=async()=>{try{return(await m.get("/api/examenes")).data.data.examenes||[]}catch(e){return console.error("Error al obtener los exámenes:",e),[]}},A=async e=>{if(e.length<=3)return null;try{return(await m.get(`/api/personas/buscar/${e}`)).data.data||null}catch(t){return t.response?.status!==404&&console.error("Error al buscar persona:",t),null}},I=(e,t)=>{try{return m.post(e,t).then(a=>a.data.status==="error"?(u(document.querySelector("form"),a.data.errors),null):a.data.data).catch(a=>(console.error("Error al guardar persona:",a),a.response?.data?.errors&&u(document.querySelector("form"),a.response.data.errors),null))}catch(a){return console.error("Error en la solicitud:",a),u(document.querySelector("form"),{general:["Error al procesar la solicitud."]}),null}},g=(e,t=null)=>{const a=(e.cieOptions||[]).map(n=>({value:n.codigo,text:`${n.codigo} - ${n.nombre}`}));if(a.length===0&&i.defaultCies.length>0&&i.defaultCies.forEach(n=>{a.push({value:n.codigo,text:`${n.codigo} - ${n.nombre}`})}),t){const n=a.findIndex(o=>o.value===t);n!==-1&&a.splice(n,1)}return a.length===0&&a.push({value:"",text:"Buscar CIE..."}),a.map(n=>`<option value="${n.value}">${n.text}</option>`).join(`
`)},S=e=>{const t=document.createElement("div");t.className="examen-item grid grid-cols-9 gap-2 border-b border-gray-200 dark:border-gray-700",t.dataset.examenId=e.id;const a=(e.currenTotal??e.valor*(e.cantidad||0)).toFixed(2);return t.innerHTML=`
                <p class="text-lg font-semibold col-span-3" aria-label="Nombre del examen">${e.nombre}</p>
                <input type="number" id="examen-${e.id}" name="examenes[${e.id}]"
                   class="flex w-20 px-2 py-1 text-center rounded border border-borders bg-white focus:outline-none focus:ring-2 focus:ring-primary"
                   min="0" value="${e.cantidad||0}" step="1">


                    <label for="cie_principal[${e.id}]" class="col-span-2 flex w-24 h-10 text-sm ">
                    <select name="cie_principal[${e.id}]" id="cie_principal[${e.id}]"
                     class=" w-32 ml-1 px-1 py-0.5 border border-borders rounded focus:outline-none focus:ring-2 focus:ring-primary"
                    ${e.cantidad>0?"":"disabled"}>
                        ${g(e)}
                    </select>
                    </label>

                <label for="cie_secundario[${e.id}]" class="col-span-2 flex justify-center text-sm">

                    <select name="cie_secundario[${e.id}]" id="cie_secundario[${e.id}]"
                    class="w-full ml-1 px-1 py-0.5 border border-borders rounded focus:outline-none focus:ring-2 focus:ring-primary"
                    ${e.cantidad>0?'aria-disabled="false"':"disabled"}>
                        ${g(e,e.ciePrincipal??null)}
                    </select>

                </label>


            <p id="precio-${e.id}"
                class="text-sm ${e.currenTotal?"text-gray-900":"text-gray-500"} precio" >
                    $ ${a}
            </p>

        `,t},_=e=>{const t=document.createElement("div");t.className="grid grid-cols-9 gap-2 font-bold border-b-2 border-gray-300 dark:border-gray-600 pb-2 mb-2",t.innerHTML=`
            <span class="col-span-3">Examen</span>
            <span class="text-center">Cantidad</span>
            <span class="col-span-2 text-center">CIE Principal</span>
            <span class="col-span-2 text-center">CIE Secundario</span>
            <span class="text-center">Precio</span>
        `,r.examenesContainer.innerHTML="",r.examenesContainer.scrollTop=0,r.examenesContainer.appendChild(t);const a=document.createDocumentFragment();e.forEach(n=>a.appendChild(S(n))),r.examenesContainer.appendChild(a),f()},f=()=>{const e=i.examenesVisibles.reduce((t,a)=>t+(a.currenTotal||0),0);r.totalExamenesSpan&&(r.totalExamenesSpan.textContent=`Total: $ ${e.toFixed(2)}`)},$=()=>{const e=r.busquedaExamenInput.value.toLowerCase();i.examenesVisibles=i.todosLosExamenes.filter(t=>e.length<1||t.nombre.toLowerCase().includes(e)),_(i.examenesVisibles)},O=async e=>{const t=e.target.form,a=e.target.value,n=await A(a);n?x(t,n):(t.tipoGuardado.value=c.NUEVO_USUARIO,t.tipoGuardado.textContent="Usuario Nuevo")},P=e=>{e.addEventListener("focus",n=>{n.target.value="",i.filteredMunicipios=i.municipios,E(e.form,i.filteredMunicipios)});const t=e.form,a=t.querySelector('select[name="municipio"]');e.addEventListener("focus",()=>{b(a)}),e.addEventListener("input",()=>{const n=e.value.toLowerCase();i.filteredMunicipios=i.municipios.filter(o=>o.municipio.toLowerCase().includes(n)||o.departamento.toLowerCase().includes(n)),E(t,i.filteredMunicipios)})},L=async e=>{const t=e.target,a=new FormData(t),n=a.get("perfil")===c.PACIENTE,o=t.tipoGuardado.value===c.ACTUALIZAR_USUARIO;let s="/api/personas";return o&&(s=`/api/personas/${n?r.paciente.value:r.acompaniante.value}`,a.append("_method","PUT")),await I(s,a)},U=(e,t=!0,a)=>{e&&(t?r.paciente.value=e.id:r.acompaniante.value=e.id,a.classList.add("bg-green-100","dark:bg-green-800","border-green-400","dark:border-green-600","text-green-700","dark:text-green-300","rounded-lg","p-4","mb-4"),Array.from(a.elements).forEach(n=>{n.type!=="hidden"&&(n.setAttribute("disabled","disabled"),n.classList.add("bg-stone-300","dark:bg-gray-700","cursor-not-allowed"))}))},M=e=>{if(e.target.matches('input[type="number"]')){const t=e.target,a=parseInt(t.closest(".examen-item").dataset.examenId,10),n=i.examenesVisibles.find(l=>l.id===a),o=document.getElementById(`precio-${n.id}`),s=t.closest(".examen-item").querySelector(`select[name="cie_principal[${n.id}]"]`),d=t.closest(".examen-item").querySelector(`select[name="cie_secundario[${n.id}]"]`);if(n){let l=parseInt(t.value,10);(isNaN(l)||l<0)&&(l=0,t.value="0"),n.cantidad=l,n.currenTotal=n.valor*n.cantidad,o&&(o.textContent=`$ ${n.currenTotal.toFixed(2)}`,o.className="text-sm text-gray-900 dark:text-green-500 precio",n.currenTotal==0&&(o.textContent="$ 0.00",o.className="text-sm text-gray-900 dark:text-gray-500 precio")),l>0?(s.removeAttribute("disabled"),s.setAttribute("aria-disabled","false"),d.removeAttribute("disabled"),d.setAttribute("aria-disabled","false"),n.ciePrincipal=s.value||null,n.cieSecundario=d.value||null):(s.setAttribute("disabled","disabled"),s.value="",d.setAttribute("disabled","disabled"),d.value=""),f()}}},q=e=>{const t=e.options[e.selectedIndex],a=e.form.numero_documento,n=e.form.pais;if(N(t.value,n),a.setCustomValidity(""),a.classList.remove("border-red-500","dark:border-red-600"),t){const o=t.dataset.valor,s=i.tiposDocumento.find(l=>l.cod_rips===o);if(!new RegExp(s.regex_validacion||"^[A-Z0-9]+$").test(a.value)){a.classList.add("border-red-500","dark:border-red-600"),a.setCustomValidity("El número de documento no es válido según el tipo de documento "+s.nombre),u(e.form,{numero_documento:["El número de documento no es válido para "+s.nombre]});return}(o==="MS"||o==="AS")&&alert("Población Especial del Régimen Subsidiado que no están identificados por la Registraduría Nacional del Estado Civil (RNEC) y que se encuentren en el correspondiente listado censal"),(!s.cod_dian||s.requiere_acudiente)&&(r.handleShowAcompaniante.checked=!0,r.handleShowAcompaniante.disabled=!0,r.handleShowAcompaniante.classList.add("cursor-not-allowed","opacity-50"))}},N=(e,t)=>{if(i.tiposDocumento.filter(o=>o.es_nacional).some(o=>o.cod_rips===e)){t.value="170";return}};export{i as a,L as b,O as c,r as d,v as e,T as f,C as g,$ as h,y as i,P as j,M as k,U as n,_ as r,q as v};
